<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Accents Libres</title>
<script>
(async () => {
  // 1) 수동 강제: ?layout=azerty | ?layout=qwerty | #azerty | #qwerty
  const url = new URL(location.href);
  const force = url.searchParams.get('layout') || (location.hash||'').slice(1);
  if (force === 'azerty' || force === 'qwerty') {
    localStorage.setItem('al_layout', force);
    location.replace(force + '.html'); return;
  }

  // 2) 레이아웃 맵으로 감지 (HTTPS/localhost에서만)
  let guess = null;
  try {
    if (navigator.keyboard?.getLayoutMap) {
      const m = await navigator.keyboard.getLayoutMap();
      const Q = (m.get('KeyQ')||'').toLowerCase();
      const A = (m.get('KeyA')||'').toLowerCase();
      const D1= (m.get('Digit1')||'');      // AZERTY면 보통 '&'
      const isAzerty = (Q==='a' && A==='q') || (D1 && D1 !== '1');
      guess = isAzerty ? 'azerty' : 'qwerty';
    }
  } catch {}

  // 3) 폴백: 언어
  if (!guess) {
    const lang = (navigator.language||'').toLowerCase();
    guess = lang.startsWith('fr') ? 'azerty' : 'qwerty';
  }

  // 4) 캐시 갱신 후 이동
  localStorage.setItem('al_layout', guess);
  location.replace(guess + '.html');
})();
</script>
<body>Redirection…</body>
